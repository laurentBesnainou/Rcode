geom_col(aes(y=Calculs-.05), position = "dodge",alpha = 0.1, colour = "#56B4E9")+
labs(
title = "Taux de staffing sur les 3 mois à venir",
subtitle = "Le calcul (Ferme+Conges+Maladie)/jhPossible",
caption = "Données de la base Azure"
)
staffGraph %>% ggplot(aes(x=Mois,y=Calculs,fill = pourcentage,label = Calculs)) +
scale_fill_manual(values=c("#999999", "#E69F00", "#56B4E9"))+
geom_col(position = "dodge",binwidth = 1) + geom_text(nudge_y = 0.5, check_overlap = TRUE)+
geom_col(aes(y=Calculs-.05), position = "dodge",alpha = 0.1, colour = "#56B4E9")+
labs(
title = "Taux de staffing sur les 3 mois à venir",
subtitle = "Le calcul (Ferme+Conges+Maladie)/jhPossible",
caption = "Données de la base Azure"
)
staffGraph %>% ggplot(aes(x=Mois,y=Calculs,fill = pourcentage,label = Calculs)) +
scale_fill_manual(labels = c("T999", "T888"),values=c("#999999", "#E69F00", "#56B4E9"))+
geom_col(position = "dodge",binwidth = 1) +
geom_col(aes(y=Calculs-.05), position = "dodge",alpha = 0.1, colour = "#56B4E9")+
labs(
title = "Taux de staffing sur les 3 mois à venir",
subtitle = "Le calcul (Ferme+Conges+Maladie)/jhPossible",
caption = "Données de la base Azure"
)
staffGraph %>% ggplot(aes(x=Mois, y=Calculs,fill = pourcentage,label = Calculs)) +
scale_fill_manual(labels = c("% Ferme", "% Provisoire"),values=c("#999999", "#E69F00", "#56B4E9"))+
geom_col(position = "dodge",binwidth = 1) +
geom_col(aes(y=Calculs-.05), position = "dodge",alpha = 0.1, colour = "#56B4E9")+
labs(
title = "Taux de staffing sur les 3 mois à venir",
subtitle = "Le calcul (Ferme+Conges+Maladie)/jhPossible",
caption = "Données de la base Azure"
)
staffGraph %>% ggplot(aes(x=Mois, y=Calculs,fill = pourcentage,label = Calculs)) +
scale_fill_manual(labels = c("% Ferme", "% Provisoire"),values=c("#999999", "#E69F00", "#56B4E9"))+
geom_col(position = "dodge",binwidth = 1) + scale_y_continuous(labels = scales::percent)+
geom_col(aes(y=Calculs-.05), position = "dodge",alpha = 0.1, colour = "#56B4E9")+
labs(
title = "Taux de staffing sur les 3 mois à venir",
subtitle = "Le calcul (Ferme+Conges+Maladie)/jhPossible",
caption = "Données de la base Azure"
)
staffGraph %>% ggplot(aes(x=Mois, y=Calculs,fill = pourcentage,label = Calculs)) +
scale_fill_manual(labels = c("% Ferme", "% Provisoire"),values=c("#999999", "#E69F00", "#56B4E9"))+
geom_col(position = "dodge",binwidth = 1) + scale_y_continuous(labels = scales::percent)+
geom_col(aes(y=Calculs-.05), position = "dodge",alpha = 0.1, colour = "#56B4E9")+
geom_hline(yintercept = .80, colour ="red",linetype="dotted", size=3)+
labs(
title = "Taux de staffing sur les 3 mois à venir",
subtitle = "Le calcul (Ferme+Conges+Maladie)/jhPossible",
caption = "Données de la base Azure"
)
staffGraph %>% ggplot(aes(x=Mois, y=Calculs,fill = pourcentage,label = Calculs)) +
scale_fill_manual(labels = c("% Ferme", "% Provisoire"),values=c("#999999", "#E69F00", "#56B4E9"))+
geom_col(position = "dodge",binwidth = 1) + scale_y_continuous(labels = scales::percent)+
geom_col(aes(y=Calculs-.05), position = "dodge",alpha = 0.1, colour = "#56B4E9")+
geom_hline(yintercept = .80, colour ="red",linetype="dotted", size=2)+
labs(
title = "Taux de staffing sur les 3 mois à venir",
subtitle = "Le calcul (Ferme+Conges+Maladie)/jhPossible",
caption = "Données de la base Azure"
)
staffGraph %>% ggplot(aes(x=Mois, y=Calculs,fill = pourcentage,label = Calculs)) +
scale_fill_manual(labels = c("% Ferme", "% Provisoire"),values=c("#999999", "#E69F00", "#56B4E9"))+
geom_col(position = "dodge",binwidth = 1) + scale_y_continuous(labels = scales::percent)+
geom_col(aes(y=Calculs-.05), position = "dodge",alpha = 0.1, colour = "yellow")+
geom_hline(yintercept = .80, colour ="red",linetype="dotted", size=2)+
labs(
title = "Taux de staffing sur les 3 mois à venir",
subtitle = "Le calcul (Ferme+Conges+Maladie)/jhPossible",
caption = "Données de la base Azure"
)
staffGraph %>% ggplot(aes(x=Mois, y=Calculs,fill = pourcentage,label = Calculs)) +
scale_fill_manual(labels = c("% Ferme", "% Provisoire"),values=c("#999999", "#E69F00", "#56B4E9"))+
geom_col(position = "dodge",binwidth = 1) + scale_y_continuous(labels = scales::percent)+
geom_col(aes(y=Calculs-.05), position = "dodge",alpha = 0.1, colour = "#56B4E9")+
geom_hline(yintercept = .80, colour ="red",linetype="dotted", size=2)+
labs(
title = "Taux de staffing sur les 3 mois à venir",
subtitle = "Le calcul (Ferme+Conges+Maladie)/jhPossible",
caption = "Données de la base Azure"
)
staffGraph %>% ggplot(aes(x=Mois, y=Calculs,fill = pourcentage,label = Calculs)) +
scale_fill_manual(labels = c("% Ferme", "% Provisoire"),values=c("#999999", "#E69F00", "#56B4E9"))+
geom_col(position = "dodge",binwidth = 1) + scale_y_continuous(labels = scales::percent)+
geom_col(aes(y=Calculs-.05), position = "dodge",alpha = 0.1, colour = "#56B4E9")+
geom_hline(yintercept = .80, colour ="red",linetype="dotted", size=2)+
labs(
title = "Taux de staffing sur les 3 mois à venir",
subtitle = "Calcul (Ferme+Conges+Maladie)/jhPossible",
caption = "En bleu les données de la semaine précédente"
)
View(bt_staffingbt)
bt_staffingbt %>% mutate(Semaine=3)
HistoriqueStaffing <- bt_staffingbt %>% mutate(Semaine=3)
HistoriqueStaffing <- bt_staffingbt %>% mutate(Semaine=3)
save(HistoriqueStaffing,file="HistoriqueStaffing.RData")
shiny::runApp()
runApp()
View(HistoriqueStaffing)
runApp()
bt_staffingbt <- bt_staffingbt %>% mutate (Mois=month(date_staffing)) %>% mutate(Annee=year(date_staffing))
bt_staffing3mois <- bt_staffingbt %>% filter (Mois %in% c(mois,moisPlus1,moisPlus2), Annee %in% c(annee, anneePlus1))
#On calcul le nombre de jours possibles par mois
staff3mois <- bt_staffing3mois %>%
filter(activite %in% c("0. Jours possibles","1. Mission ferme","2. Mission prévue","4. Congés","7. Arrêt Maladie")) %>% group_by(date_staffing,activite) %>%
summarise(jhTotal= 1*sum(jh, na.rm=TRUE)) %>% spread(activite,jhTotal)
colnames(staff3mois) <- c("Mois","jhPossible","Ferme","Provisoire","Conges","Maladie")
staff3mois <- staff3mois %>% replace_na(list(Provisoire = 0, Ferme = 0, Conges=0,Maladie=0 ))
#On calcule le % Ferme et % avec provisoire
staff3mois <- staff3mois %>% mutate(PFerme= (-(Ferme+Conges+Maladie)/jhPossible)) %>%
mutate(PProvisoire= (-(Ferme+Provisoire+Conges+Maladie)/jhPossible))
#on remet les données en tableau pour faire l'histograme
staffGraph <- staff3mois %>% ungroup() %>%select(Mois,PFerme,PProvisoire) %>%
gather(pourcentage,Calculs,PFerme:PProvisoire)
runApp()
bt_staffingbt <- bt_staffingbt %>% mutate (Mois=month(date_staffing)) %>% mutate(Annee=year(date_staffing))
bt_staffing3mois <- bt_staffingbt %>% filter (Mois %in% c(mois,moisPlus1,moisPlus2), Annee %in% c(annee, anneePlus1))
#On calcul le nombre de jours possibles par mois
staff3mois <- bt_staffing3mois %>%
filter(activite %in% c("0. Jours possibles","1. Mission ferme","2. Mission prévue","4. Congés","7. Arrêt Maladie")) %>% group_by(date_staffing,activite) %>%
summarise(jhTotal= 1*sum(jh, na.rm=TRUE)) %>% spread(activite,jhTotal)
colnames(staff3mois) <- c("Mois","jhPossible","Ferme","Provisoire","Conges","Maladie")
staff3mois <- staff3mois %>% replace_na(list(Provisoire = 0, Ferme = 0, Conges=0,Maladie=0 ))
#On calcule le % Ferme et % avec provisoire
staff3mois <- staff3mois %>% mutate(PFerme= (-(Ferme+Conges+Maladie)/jhPossible)) %>%
mutate(PProvisoire= (-(Ferme+Provisoire+Conges+Maladie)/jhPossible))
#on remet les données en tableau pour faire l'histograme
staffGraph <- staff3mois %>% ungroup() %>%select(Mois,PFerme,PProvisoire) %>%
gather(pourcentage,Calculs,PFerme:PProvisoire)
HistoriqueStaffing3mois <- HistoriqueStaffing %>% filter (Mois %in% c(mois,moisPlus1,moisPlus2), Annee %in% c(annee, anneePlus1))
#On calcul le nombre de jours possibles par mois
Histo3mois <- HistoriqueStaffing3mois %>%
filter(activite %in% c("0. Jours possibles","1. Mission ferme","2. Mission prévue","4. Congés","7. Arrêt Maladie")) %>% group_by(date_staffing,activite) %>%
summarise(jhTotal= 1*sum(jh, na.rm=TRUE)) %>% spread(activite,jhTotal)
colnames(Histo3mois) <- c("Mois","jhPossible","Ferme","Provisoire","Conges","Maladie")
H3mois <- Histo3mois %>% replace_na(list(Provisoire = 0, Ferme = 0, Conges=0,Maladie=0 ))
#On calcule le % Ferme et % avec provisoire
H3mois <- H3mois %>% mutate(PFerme= (-(Ferme+Conges+Maladie)/jhPossible)) %>%
mutate(PProvisoire= (-(Ferme+Provisoire+Conges+Maladie)/jhPossible))
#on remet les données en tableau pour faire l'histograme
HGraph <- H3mois %>% ungroup() %>%select(Mois,PFerme,PProvisoire) %>%
gather(pourcentage,Calculs,PFerme:PProvisoire)
View(HGraph)
HGraph
staffGraph
staffGraph %>% ggplot(aes( y=Calculs,fill = pourcentage,label = Calculs)) +
scale_fill_manual(labels = c("% Ferme", "% Provisoire"),values=c("#999999", "#E69F00", "#56B4E9"))+
geom_col(position = "dodge",binwidth = 1) + scale_y_continuous(labels = scales::percent)
staffGraph %>% ggplot(aes( y=Calculs,fill = pourcentage,label = Calculs)) +
scale_fill_manual(labels = c("% Ferme", "% Provisoire"),values=c("#999999", "#E69F00", "#56B4E9"))+
geom_col(position = "dodge") + scale_y_continuous(labels = scales::percent)
staffGraph
staffGraph %>% ggplot(aes( y=Calculs,fill = pourcentage,label = Calculs)) +
scale_fill_manual(labels = c("% Ferme", "% Provisoire"),values=c("#999999", "#E69F00", "#56B4E9"))+
geom_col(position = "dodge")
staffGraph %>% ggplot(aes( y=Calculs,fill = pourcentage,label = Calculs)) +
scale_fill_manual(labels = c("% Ferme", "% Provisoire"),values=c("#999999", "#E69F00", "#56B4E9"))
staffGraph %>% ggplot(aes( y=Calculs,fill = pourcentage,label = Calculs)) +
scale_fill_manual(labels = c("% Ferme", "% Provisoire"),values=c("#999999", "#E69F00", "#56B4E9"))+
geom_col(position = "dodge")
staffGraph
staffGraph %>% ggplot(aes( y=Calculs,fill = pourcentage,label = Calculs)) +
scale_fill_manual(labels = c("% Ferme", "% Provisoire"),values=c("#999999", "#E69F00", "#56B4E9"))+
geom_col()
staffGraph %>% ggplot(aes( x=Mois,y=Calculs,fill = pourcentage,label = Calculs)) +
scale_fill_manual(labels = c("% Ferme", "% Provisoire"),values=c("#999999", "#E69F00", "#56B4E9"))+
geom_col()
staffGraph %>% ggplot(aes( x=Mois,y=Calculs,fill = pourcentage,label = Calculs)) +
scale_fill_manual(labels = c("% Ferme", "% Provisoire"),values=c("#999999", "#E69F00", "#56B4E9"))+
geom_col(position = "dodge") + scale_y_continuous(labels = scales::percent)+
geom_col(HGraph,aes(x=Mois,y=Calculs), position = "dodge",alpha = 0.1, colour = "#56B4E9")+
geom_hline(yintercept = .80, colour ="red",linetype="dotted", size=2)+
labs(
title = "Taux de staffing sur les 3 mois à venir",
subtitle = "Calcul (Ferme+Conges+Maladie)/jhPossible",
caption = "En bleu les données de la semaine précédente"
)
staffGraph %>% ggplot(aes( x=Mois,y=Calculs,fill = pourcentage,label = Calculs)) +
scale_fill_manual(labels = c("% Ferme", "% Provisoire"),values=c("#999999", "#E69F00", "#56B4E9"))+
geom_col(position = "dodge") + scale_y_continuous(labels = scales::percent)
staffGraph %>% ggplot(aes( x=Mois,y=Calculs,fill = pourcentage,label = Calculs)) +
scale_fill_manual(labels = c("% Ferme", "% Provisoire"),values=c("#999999", "#E69F00", "#56B4E9"))+
geom_col(position = "dodge") + scale_y_continuous(labels = scales::percent)+
geom_col(HGraph,aes(x=Mois,y=Calculs), position = "dodge",alpha = 0.1, colour = "#56B4E9")
HGraph
staffGraph %>% ggplot(aes( x=Mois,y=Calculs,fill = pourcentage,label = Calculs)) +
scale_fill_manual(labels = c("% Ferme", "% Provisoire"),values=c("#999999", "#E69F00", "#56B4E9"))+
geom_col(position = "dodge") + scale_y_continuous(labels = scales::percent)+
geom_col(HGraph,position = "dodge",alpha = 0.1, colour = "#56B4E9")
staffGraph %>% ggplot(aes( x=Mois,y=Calculs,fill = pourcentage,label = Calculs)) +
scale_fill_manual(labels = c("% Ferme", "% Provisoire"),values=c("#999999", "#E69F00", "#56B4E9"))+
geom_col(position = "dodge") + scale_y_continuous(labels = scales::percent)+
geom_col(data =HGraph,position = "dodge",alpha = 0.1, colour = "#56B4E9")+
geom_hline(yintercept = .80, colour ="red",linetype="dotted", size=2)+
labs(
title = "Taux de staffing sur les 3 mois à venir",
subtitle = "Calcul (Ferme+Conges+Maladie)/jhPossible",
caption = "En bleu les données de la semaine précédente"
)
g
staffGraph %>% ggplot(aes( x=Mois,y=Calculs,fill = pourcentage,label = Calculs)) +
scale_fill_manual(labels = c("% Ferme", "% Provisoire"),values=c("#999999", "#E69F00", "#56B4E9"))+
geom_col(position = "dodge") + scale_y_continuous(labels = scales::percent)+
geom_col(data =HGraph,position = "dodge",alpha = 0.1, colour = "#56B4E9")+
geom_hline(yintercept = .80, colour ="red",linetype="dotted", size=2)+
labs(
title = "Taux de staffing sur les 3 mois à venir",
subtitle = "Calcul (Ferme+Conges+Maladie)/jhPossible",
caption = "En bleu les données de la semaine précédente"
)
runApp()
View(bt_staffingbt)
#Ouverture de la connexion en ODBC
conn <- odbcDriverConnect('driver={SQL Server Native Client 11.0};server=airmis-colmngt-db.database.windows.net,1433;database=airmis-pilotage-prod;Uid=pwbi;Pwd=4:j45_XcN4;Encrypt=yes;TrustServerCertificate=no;Connection Timeout=30;')
#on charge les données historique CA et Staffing de la semaine passée
load("HistoriqueCA.RData")
load("HistoriqueStaffing.RData")
#on récupere les tables Pipe CA_Pipe et Staffing BT
bt_pipebt <- sqlQuery(conn, "SELECT * FROM bt_pipebt;")
bt_capipebt  <- sqlQuery(conn, "SELECT * FROM bt_capipebt;")
groupe_totem  <- sqlQuery(conn, "SELECT * FROM groupe_totem;")
bt_effectif <- sqlQuery(conn, "SELECT * FROM bt_Effectif;")
bt_effectifGrade <- sqlQuery(conn, "SELECT * FROM bt_Effectif, groupe_grade where grade_id =groupe_grade.id ;")
bt_staffingbt  <- sqlQuery(conn, "SELECT * FROM bt_staffingbt;")
QueryCA <-  sqlQuery(conn, "SELECT bt_pipebt.id, groupe_offre.offre,annee,mission, ca_entite,ca_sst_interne,ca_sst_externe,ca_markup,probabilite,
etape, offre_id, compte_id, responsable_id FROM bt_pipebt, bt_capipebt, groupe_offre
WHERE pipe_id=bt_pipebt.id AND bt_pipebt.offre_id = groupe_offre.Id and annee=2018;")
bt_pipeTotem <- left_join(bt_pipebt, groupe_totem, by = c("totem_id" = "id"))
bt_pipeTotemCA <- left_join(bt_capipebt, bt_pipeTotem, by = c("pipe_id" = "id"))
#bt_pipeTotemCAStaffing <- left_join(bt_pipeTotemCA, bt_staffingbt, by = c("totem_id" = "totem_id"))
close(conn)
bt_effectif
connectionString <-
"Driver={SQL Server Native Client 11.0};
Server=tcp:airmis-colmngt-db.database.windows.net,1433;
Database=airmis-pilotage-prod;
Uid=pwbi
Pwd=4:j45_XcN4;
Encrypt=yes;
TrustServerCertificate=no;
Connection Timeout=30;"
#Ouverture de la connexion en ODBC
conn <- odbcDriverConnect('driver={SQL Server Native Client 11.0};server=airmis-colmngt-db.database.windows.net,1433;database=airmis-pilotage-prod;Uid=pwbi;Pwd=4:j45_XcN4;Encrypt=yes;TrustServerCertificate=no;Connection Timeout=30;')
#on charge les données historique CA et Staffing de la semaine passée
load("HistoriqueCA.RData")
load("HistoriqueStaffing.RData")
#on récupere les tables Pipe CA_Pipe et Staffing BT
bt_pipebt <- sqlQuery(conn, "SELECT * FROM bt_pipebt;")
bt_capipebt  <- sqlQuery(conn, "SELECT * FROM bt_capipebt;")
groupe_totem  <- sqlQuery(conn, "SELECT * FROM groupe_totem;")
bt_effectif <- sqlQuery(conn, "SELECT * FROM bt_Effectifbt;")
bt_effectifGrade <- sqlQuery(conn, "SELECT * FROM bt_Effectifbt, groupe_grade where grade_id =groupe_grade.id ;")
bt_staffingbt  <- sqlQuery(conn, "SELECT * FROM bt_staffingbt;")
QueryCA <-  sqlQuery(conn, "SELECT bt_pipebt.id, groupe_offre.offre,annee,mission, ca_entite,ca_sst_interne,ca_sst_externe,ca_markup,probabilite,
etape, offre_id, compte_id, responsable_id FROM bt_pipebt, bt_capipebt, groupe_offre
WHERE pipe_id=bt_pipebt.id AND bt_pipebt.offre_id = groupe_offre.Id and annee=2018;")
bt_pipeTotem <- left_join(bt_pipebt, groupe_totem, by = c("totem_id" = "id"))
bt_pipeTotemCA <- left_join(bt_capipebt, bt_pipeTotem, by = c("pipe_id" = "id"))
#bt_pipeTotemCAStaffing <- left_join(bt_pipeTotemCA, bt_staffingbt, by = c("totem_id" = "totem_id"))
close(conn)
View(bt_effectifGrade)
View(bt_staffingbt)
bt_staffing3mois %>% inner_join(bt_effectifGrade,by = c("effectif_id",id))
bt_staffingbt <- bt_staffingbt %>% mutate (Mois=month(date_staffing)) %>% mutate(Annee=year(date_staffing))
bt_staffing3mois <- bt_staffingbt %>% filter (Mois %in% c(mois,moisPlus1,moisPlus2), Annee %in% c(annee, anneePlus1))
bt_staffing3mois %>% inner_join(bt_effectifGrade,by = c("effectif_id",id))
bt_staffingbt <- bt_staffingbt %>% mutate (Mois=month(date_staffing)) %>% mutate(Annee=year(date_staffing))
bt_staffing3mois <- bt_staffingbt %>% filter (Mois %in% c(mois,moisPlus1,moisPlus2), Annee %in% c(annee, anneePlus1))
#on récupère le mois courrant our avoir le staffing sur 3 mois
mois <- month(today())
#On affiche le mois actif + les deu mois suivants
moisPlus1 <- if(mois<12) {mois+1} else {1}
moisPlus2 <- if(mois<11) {mois+2} else {2}
#Annee courante
annee <- year(today())
anneePlus1 <- if(mois>10) {annee+1} else {annee}
bt_staffing3mois <- bt_staffingbt %>% filter (Mois %in% c(mois,moisPlus1,moisPlus2), Annee %in% c(annee, anneePlus1))
bt_staffing3mois %>% inner_join(bt_effectifGrade,by = c("effectif_id",id))
bt_staffing3mois %>% inner_join(bt_effectifGrade,by = c("effectif_id","id"))
View(bt_staffing3mois)
colnames(bt_staffing3mois)
bt_effectifGrade
bt_staffing3mois %>% inner_join(bt_effectifGrade,by = c(effectif_id="id"))
bt_staffing3mois <- bt_staffing3mois %>% inner_join(bt_effectifGrade,by = c(effectif_id="id"))
#On calcul le nombre de jours possibles par mois
staff3mois <- bt_staffing3mois %>%
filter(activite %in% c("0. Jours possibles","1. Mission ferme","2. Mission prévue","4. Congés","7. Arrêt Maladie")) %>%
group_by(date_staffing,activite,grade) %>%
summarise(jhTotal= 1*sum(jh, na.rm=TRUE)) %>% spread(activite,jhTotal)
colnames(staff3mois) <- c("Mois","jhPossible","Ferme","Provisoire","Conges","Maladie")
staff3mois <- staff3mois %>% replace_na(list(Provisoire = 0, Ferme = 0, Conges=0,Maladie=0 ))
#On calcule le % Ferme et % avec provisoire
staff3mois <- staff3mois %>% mutate(PFerme= (-(Ferme+Conges+Maladie)/jhPossible)) %>%
mutate(PProvisoire= (-(Ferme+Provisoire+Conges+Maladie)/jhPossible))
#on remet les données en tableau pour faire l'histograme
staffGraph <- staff3mois %>% ungroup() %>%select(Mois,PFerme,PProvisoire) %>%
gather(pourcentage,Calculs,PFerme:PProvisoire)
bt_staffing3mois <- bt_staffing3mois %>% inner_join(bt_effectifGrade,by = c(effectif_id="id"))
staff3mois <- bt_staffing3mois %>%
filter(activite %in% c("0. Jours possibles","1. Mission ferme","2. Mission prévue","4. Congés","7. Arrêt Maladie")) %>%
group_by(date_staffing,activite,grade) %>%
summarise(jhTotal= 1*sum(jh, na.rm=TRUE)) %>% spread(activite,jhTotal)
View(bt_staffing3mois)
staff3mois <- bt_staffing3mois %>%
filter(activite %in% c("0. Jours possibles","1. Mission ferme","2. Mission prévue","4. Congés","7. Arrêt Maladie")) %>%
group_by(date_staffing,activite,grade.x) %>%
summarise(jhTotal= 1*sum(jh, na.rm=TRUE)) %>% spread(activite,jhTotal)
staff3mois
staff3mois <- bt_staffing3mois %>%
filter(activite %in% c("0. Jours possibles","1. Mission ferme","2. Mission prévue","4. Congés","7. Arrêt Maladie")) %>%
group_by(date_staffing,activite,grade.x) %>%
summarise(jhTotal= 1*sum(jh, na.rm=TRUE)) %>% spread(activite,jhTotal)
colnames(staff3mois) <- c("Mois","Grade", "jhPossible","Ferme","Provisoire","Conges","Maladie")
staff3mois <- staff3mois %>% replace_na(list(Provisoire = 0, Ferme = 0, Conges=0,Maladie=0 ))
#On calcule le % Ferme et % avec provisoire
staff3mois <- staff3mois %>% mutate(PFerme= (-(Ferme+Conges+Maladie)/jhPossible)) %>%
mutate(PProvisoire= (-(Ferme+Provisoire+Conges+Maladie)/jhPossible))
#on remet les données en tableau pour faire l'histograme
staffGraph <- staff3mois %>% ungroup() %>%select(Mois,Grade, PFerme,PProvisoire) %>%
gather(pourcentage,Calculs,PFerme:PProvisoire)
staffGraph
staffGraph %>% ggplot(aes( x=Mois,y=Calculs,fill = pourcentage,label = Calculs)) +
scale_fill_manual(labels = c("% Ferme", "% Provisoire"),values=c("#999999", "#E69F00", "#56B4E9"))+
geom_col(position = "dodge") + scale_y_continuous(labels = scales::percent)+
facet_grid(. ~ Grade)
staffGraph %>% ggplot(aes( x=Mois,y=Calculs,fill = pourcentage,label = Calculs)) +
scale_fill_manual(labels = c("% Ferme", "% Provisoire"),values=c("#999999", "#E69F00", "#56B4E9"))+
geom_col(position = "dodge") + scale_y_continuous(labels = scales::percent)+
facet_grid(Grade ~ .)+
geom_hline(yintercept = .80, colour ="red",linetype="dotted", size=2)+
labs(
title = "Taux de staffing sur les 3 mois à venir",
subtitle = "Calcul (Ferme+Conges+Maladie)/jhPossible",
caption = "En bleu les données de la semaine précédente"
)
staffGraph %>% ggplot(aes( x=Mois,y=Calculs,fill = pourcentage,label = Calculs)) +
scale_fill_manual(labels = c("% Ferme", "% Provisoire"),values=c("#999999", "#E69F00", "#56B4E9"))+
geom_col(position = "dodge") + scale_y_continuous(labels = scales::percent)+
facet_wrap(~Grade, nrow = 4)+
geom_hline(yintercept = .80, colour ="red",linetype="dotted", size=2)+
labs(
title = "Taux de staffing sur les 3 mois à venir",
subtitle = "Calcul (Ferme+Conges+Maladie)/jhPossible",
caption = "En bleu les données de la semaine précédente"
)
staffGraph %>% ggplot(aes( x=Mois,y=Calculs,fill = pourcentage,label = Calculs)) +
scale_fill_manual(labels = c("% Ferme", "% Provisoire"),values=c("#999999", "#E69F00", "#56B4E9"))+
geom_col(position = "dodge") + scale_y_continuous(labels = scales::percent)+
facet_wrap(~Grade, nrow = 4)+
geom_hline(yintercept = .80, colour ="red",size=1)+
labs(
title = "Taux de staffing sur les 3 mois à venir",
subtitle = "Calcul (Ferme+Conges+Maladie)/jhPossible",
caption = "En bleu les données de la semaine précédente"
)
runApp()
bt_staffingbt <- bt_staffingbt %>% mutate (Mois=month(date_staffing)) %>% mutate(Annee=year(date_staffing))
bt_staffing3mois <- bt_staffingbt %>% filter (Mois %in% c(mois,moisPlus1,moisPlus2), Annee %in% c(annee, anneePlus1))
bt_staffing3mois <- bt_staffing3mois %>% inner_join(bt_effectifGrade,by = c(effectif_id="id"))
#On calcul le nombre de jours possibles par mois
staff3mois <- bt_staffing3mois %>%
filter(activite %in% c("0. Jours possibles","1. Mission ferme","2. Mission prévue","4. Congés","7. Arrêt Maladie")) %>%
group_by(date_staffing,activite,grade.x) %>%
summarise(jhTotal= 1*sum(jh, na.rm=TRUE)) %>% spread(activite,jhTotal)
colnames(staff3mois) <- c("Mois","Grade", "jhPossible","Ferme","Provisoire","Conges","Maladie")
staff3mois <- staff3mois %>% replace_na(list(Provisoire = 0, Ferme = 0, Conges=0,Maladie=0 ))
#On calcule le % Ferme et % avec provisoire
staff3mois <- staff3mois %>% mutate(PFerme= (-(Ferme+Conges+Maladie)/jhPossible)) %>%
mutate(PProvisoire= (-(Ferme+Provisoire+Conges+Maladie)/jhPossible))
bt_staffingbt <- bt_staffingbt %>% mutate (Mois=month(date_staffing)) %>% mutate(Annee=year(date_staffing))
bt_staffing3mois <- bt_staffingbt %>% filter (Mois %in% c(mois,moisPlus1,moisPlus2), Annee %in% c(annee, anneePlus1))
bt_staffing3mois <- bt_staffing3mois %>% inner_join(bt_effectifGrade,by = c(effectif_id="id"))
#On calcul le nombre de jours possibles par mois
staff3mois <- bt_staffing3mois %>%
filter(activite %in% c("0. Jours possibles","1. Mission ferme","2. Mission prévue","4. Congés","7. Arrêt Maladie")) %>%
group_by(date_staffing,activite,grade.x) %>%
summarise(jhTotal= 1*sum(jh, na.rm=TRUE)) %>% spread(activite,jhTotal)
View(bt_staffing3mois)
staff3mois <- bt_staffing3mois %>%
filter(activite %in% c("0. Jours possibles","1. Mission ferme","2. Mission prévue","4. Congés","7. Arrêt Maladie")) %>%
group_by(date_staffing,activite,grade) %>%
summarise(jhTotal= 1*sum(jh, na.rm=TRUE)) %>% spread(activite,jhTotal)
colnames(staff3mois) <- c("Mois","Grade", "jhPossible","Ferme","Provisoire","Conges","Maladie")
staff3mois <- staff3mois %>% replace_na(list(Provisoire = 0, Ferme = 0, Conges=0,Maladie=0 ))
View(staff3mois)
runApp()
runApp()
staffGraph%>% ggplot(aes(Mois, Grade)) + geom_tile(aes(fill = Calculs), colour = "white") +
scale_fill_gradient(low = "white",high = "steelblue")
staffGraph%>% ggplot(aes(Mois, Grade)) + geom_tile(aes(fill = Calculs), colour = "white") +
scale_fill_gradient(low = "white",high = "steelblue")+
theme_grey(base_size = base_size) + labs(x = "",y="")
base_size <- 9
staffGraph%>% ggplot(aes(Mois, Grade)) + geom_tile(aes(fill = Calculs), colour = "white") +
scale_fill_gradient(low = "white",high = "steelblue")+
theme_grey(base_size = base_size) + labs(x = "",y="")
base_size <- 9
staffGraph%>% ggplot(aes(Mois, Grade)) + geom_tile(aes(fill = Calculs), colour = "white") +
scale_fill_gradient(low = "white",high = "steelblue")+
theme_grey(base_size = base_size) + labs(x = "",y="")+
scale_x_discrete(expand = c(0, 0))+
scale_y_discrete(expand = c(0, 0)) +
opts(legend.position = "none",axis.ticks = theme_blank(),
axis.text.x = theme_text(size = base_size0.8, angle = 330, hjust = 0, colour = "grey50"))
base_size <- 9
staffGraph%>% ggplot(aes(Mois, Grade)) + geom_tile(aes(fill = Calculs), colour = "white") +
scale_fill_gradient(low = "white",high = "steelblue")+
theme_grey(base_size = base_size) + labs(x = "",y="")+
scale_x_discrete(expand = c(0, 0))+
scale_y_discrete(expand = c(0, 0))
base_size <- 9
staffGraph%>% ggplot(aes(Mois, Grade)) + geom_tile(aes(fill = Calculs), colour = "white") +
scale_fill_gradient(low = "white",high = "steelblue")+
theme_grey(base_size = base_size) + labs(x = "",y="")+
scale_x_discrete(expand = c(0, 0))+
scale_y_discrete(expand = c(0, 0)) +
opts(legend.position = "none",axis.ticks = theme_blank(),
axis.text.x = theme_text(size = base_size*0.8, angle = 330, hjust = 0, colour = "grey50"))
base_size <- 9
staffGraph%>% ggplot(aes(Mois, Grade)) + geom_tile(aes(fill = Calculs), colour = "white") +
scale_fill_gradient(low = "white",high = "steelblue")+
theme_grey(base_size = base_size) + labs(x = "",y="")+
scale_x_discrete(expand = c(0, 0))+
scale_y_discrete(expand = c(0, 0)) +
theme(legend.position = "none",axis.ticks = theme_blank(),
axis.text.x = theme_text(size = base_size*0.8, angle = 330, hjust = 0, colour = "grey50"))
base_size <- 9
staffGraph%>% ggplot(aes(Mois, Grade)) + geom_tile(aes(fill = Calculs), colour = "white") +
scale_fill_gradient(low = "white",high = "steelblue")+
theme_grey(base_size = base_size) + labs(x = "",y="")+
scale_x_discrete(expand = c(0, 0))+
scale_y_discrete(expand = c(0, 0)) +
geom_text(aes(label = round(Calculs, 1)))
base_size <- 9
staffGraph%>% ggplot(aes(Mois, Grade)) + geom_tile(aes(fill = Calculs), colour = "white") +
scale_fill_gradient(low = "white",high = "steelblue")+
theme_grey(base_size = base_size) + labs(x = "",y="")+
geom_text(aes(label = Calculs))
staffGraph%>% ggplot(aes(Mois, Grade)) + geom_tile(aes(fill = Calculs), colour = "white") +
scale_fill_gradient(low = "white", high = "red") +
geom_text(aes(label = round(Calculs,2)))
View(staffGraph)
staffGraph%>% filter(pourcentage=="PFerme") %>% ggplot(aes(Mois, Grade)) + geom_tile(aes(fill = Calculs), colour = "white") +
scale_fill_gradient(low = "white", high = "red") +
geom_text(aes(label = round(Calculs,2)))
staffGraph%>% filter(pourcentage=="PFerme") %>% ggplot(aes(Mois, Grade)) + geom_tile(aes(fill = Calculs), colour = "white") +
scale_fill_gradient(limits = c(0,0.8,1),low = "white", high = "red") +
geom_text(aes(label = round(Calculs,2)))
staffGraph%>% filter(pourcentage=="PFerme") %>% ggplot(aes(Mois, Grade)) + geom_tile(aes(fill = Calculs), colour = "white") +
scale_fill_gradient(limits = c(0,1),low = "white", high = "red") +
geom_text(aes(label = round(Calculs,2)))
staffGraph%>% filter(pourcentage=="PFerme") %>% ggplot(aes(Mois, Grade)) + geom_tile(aes(fill = Calculs), colour = "white") +
scale_fill_gradient(limits = c(0,1),low = "white", high = "Green") +
geom_text(aes(label = round(Calculs,2)))
base_size <- 9
staffGraph%>% filter(pourcentage=="PFerme") %>% ggplot(aes(Mois, Grade)) + geom_tile(aes(fill = Calculs), colour = "white") +
scale_fill_gradient(limits = c(0,1),colours=c("red","white","green")) +
geom_text(aes(label = round(Calculs,2)))
base_size <- 9
staffGraph%>% filter(pourcentage=="PFerme") %>% ggplot(aes(Mois, Grade)) + geom_tile(aes(fill = Calculs), colour = "white") +
scale_fill_gradientn(limits = c(0,1),colours=c("red","white","green")) +
geom_text(aes(label = round(Calculs,2)))
staffGraph%>% filter(pourcentage=="PFerme") %>% ggplot(aes(Mois, Grade)) + geom_tile(aes(fill = Calculs), colour = "white") +
scale_fill_gradientn(limits = c(0,0.8,1),colours=c("red","white","green")) +
geom_text(aes(label = round(Calculs,2)))
staffGraph%>% filter(pourcentage=="PFerme") %>% ggplot(aes(Mois, Grade)) + geom_tile(aes(fill = Calculs), colour = "white") +
scale_fill_gradientn(limits = c(0,1),low = muted("red"), mid = "white",
high = muted("blue")) +
geom_text(aes(label = round(Calculs,2)))
staffGraph%>% filter(pourcentage=="PFerme") %>% ggplot(aes(Mois, Grade)) + geom_tile(aes(fill = Calculs), colour = "white") +
scale_colour_gradient2(limits = c(0,1),low = muted("red"), mid = "white",
high = muted("blue")) +
geom_text(aes(label = round(Calculs,2)))
base_size <- 9
staffGraph%>% filter(pourcentage=="PFerme") %>% ggplot(aes(Mois, Grade)) + geom_tile(aes(fill = Calculs), colour = "white") +
scale_colour_gradient2(limits = c(0,1),low = "red", mid = "white",
high ="blue)) +
geom_text(aes(label = round(Calculs,2)))
staffGraph%>% filter(pourcentage=="PFerme") %>% ggplot(aes(Mois, Grade)) + geom_tile(aes(fill = Calculs), colour = "white") +
scale_colour_gradient2(limits = c(0,1),low = "red", mid = "white",
high ="blue") +
geom_text(aes(label = round(Calculs,2)))
staffGraph%>% filter(pourcentage=="PFerme") %>% ggplot(aes(Mois, Grade)) + geom_tile(aes(fill = Calculs), colour = "white") +
scale_colour_gradient2(limits = c(0,1),low = "red", mid = "white",
high ="green") +
geom_text(aes(label = round(Calculs,2)))
staffGraph%>% filter(pourcentage=="PFerme") %>% ggplot(aes(Mois, Grade)) + geom_tile(aes(fill = Calculs), colour = "white") +
scale_colour_gradient2(limits = c(0,1),low = "red", mid = "white",
high ="green") +
geom_text(aes(label = round(Calculs,2)))
base_size <- 9
staffGraph%>% filter(pourcentage=="PFerme") %>% ggplot(aes(Mois, Grade)) + geom_tile(aes(fill = Calculs), colour = "white") +
scale_fill_gradientn(limits = c(0,1),low = "red", mid = "white",
high ="green") +
geom_text(aes(label = round(Calculs,2)))
staffGraph%>% filter(pourcentage=="PFerme") %>% ggplot(aes(Mois, Grade)) + geom_tile(aes(fill = Calculs), colour = "white") +
scale_fill_gradientn(limits = c(0,1),colors("red","orange","green")) +
geom_text(aes(label = round(Calculs,2)))
staffGraph%>% filter(pourcentage=="PFerme") %>% ggplot(aes(Mois, Grade)) + geom_tile(aes(fill = Calculs), colour = "white") +
scale_fill_gradientn(limits = c(0,1),colors=c("red","orange","green")) +
geom_text(aes(label = round(Calculs,2)))
staffGraph%>% filter(pourcentage=="PFerme") %>% ggplot(aes(Mois, Grade)) + geom_tile(aes(fill = Calculs), colour = "white") +
scale_fill_gradientn(limits = c(0,1),colors=c("red","maroon","green")) +
geom_text(aes(label = round(Calculs,2)))
staffGraph%>% filter(pourcentage=="PFerme") %>% ggplot(aes(Mois, Grade)) + geom_tile(aes(fill = Calculs), colour = "white") +
scale_fill_gradientn(limits = c(0,1),colors=c("red","orange","green")) +
geom_text(aes(label = round(Calculs,2)))
runApp()
library(plotly)
runApp()
runApp()
